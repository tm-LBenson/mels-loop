/* stylelint-disable scss/at-mixin-pattern */
@use 'sass:map';
@use 'sass:string';
@import './refs';
@import './states';

@function -get-part-var($comp, $part) {
	@return #{$comp}-#{$part};
}

@function -get-module-part-var($comp, $module, $part) {
	@return #{$module}-#{$part};
}

@mixin _map-vars($comp, $module, $props, $part: '', $state: '') {
	$var: if(string.length($part) > 0, -get-part-var($comp, $part), $comp);
	$ref: if(
		string.length($part) > 0,
		-get-module-part-var($comp, $module, $part),
		$module
	);

	@each $prop in $props {
		#{varName(#{$var}-#{$prop}#{$state})}: #{compRef($ref, $prop, $state)};
	}
}

@mixin transform($module, $map) {
	$compName: map.get($map, comp);
	$overrides: map.get($map, overrides);

	@each $key, $refs in $overrides {
		// extract root vars
		$rootVars: map.get($refs, _);

		// if key is `_` (root) then use empty string
		$partName: if($key == '_', '', $key);

		@each $ref in map.keys($refs) {
			$state: if($ref == '_', '', $ref);

			@include _map-vars($compName, $module, $rootVars, $partName, $state);
		}
	}
}
